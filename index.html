<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NerryLLM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;padding:0;background:linear-gradient(135deg,#0f0f0f,#1a1a1a);color:white;font-family:Arial,sans-serif;display:flex;flex-direction:column;height:100vh;}
.container{flex:1;display:flex;flex-direction:column;padding:10px;}
h1{text-align:center;margin:10px 0;font-size:26px;text-shadow:0 0 12px #9b59b6;}
#chat{flex:1;background:#111;border-radius:20px;padding:12px;overflow-y:auto;margin-bottom:12px;box-shadow: inset 0 0 18px #222;word-wrap:break-word;}
.message{margin-bottom:12px;padding:8px 14px;border-radius:14px;line-height:1.4;max-width:85%;}
.user{background:#00ffcc33;align-self:flex-end;color:#00ffcc;box-shadow:0 0 6px #00ffcc66;}
.ai{background:#ff66ff33;align-self:flex-start;color:#ff66ff;box-shadow:0 0 6px #ff66ff66;}
.inputRow{display:flex;gap:2px;}
input{flex:1;padding:14px;border-radius:14px 0 0 14px;border:none;font-size:16px;background:#222;color:white;}
input:focus{outline:none;}
button{padding:14px;border-radius:0 14px 14px 0;background:linear-gradient(45deg,purple,#9b59b6);border:none;font-size:16px;cursor:pointer;color:white;font-weight:bold;transition:0.2s;}
button:hover{transform:scale(1.05);}
.spinner{display:inline-block;width:18px;height:18px;border:3px solid #fff3;border-radius:50%;border-top-color:#fff;animation:spin 0.8s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
</style>
</head>
<body>
<div class="container">
<h1>Nerry</h1>
<div id="chat"></div>
<div class="inputRow">
<input id="userInput" placeholder="Type a message..." />
<button id="sendBtn">Send</button>
</div>
</div>
<script>
// ===== PRELOADED DATA =====
const INTENTS={
  "greeting":{"patterns":["hi","hello","yo","sup"],"weight":1.0},
  "android_help":{"patterns":["android","aide","gradle","manifest"],"weight":1.5},
  "default":{"patterns":[],"weight":0}
};
const KNOWLEDGE={
  "greeting":{"templates":["Hey there! How's it going?","Yo! What's up?","Hello! Ready to chat?"],"details":["Let's have a fun conversation!","Ask me anything."]},
  "android_help":{"templates":["About {topic}, hereâ€™s what matters:","For {topic}, the key is:"],"details":["AndroidIDE lets you code on-device.","Gradle builds are supported natively."]},
  "default":{"templates":["Hmm, I need more info about {topic}.","Can you clarify about {topic}?"],"details":[]}
};
const PERSONALITY={"tone":"casual","slang_probability":0.3,"slang":["bruh","fr","lowkey"],"signature_style":["ðŸ”¥","ðŸ˜"]};

// ===== MEMORY =====
let conversationHistory=JSON.parse(localStorage.getItem("nerry_history")||"[]");
let dynamicKnowledge=JSON.parse(localStorage.getItem("nerry_dynamic")||"{}");

// ===== ENGINE =====
function updateContext(userInput,aiResponse){
  conversationHistory.push({user:userInput,ai:aiResponse});
  if(conversationHistory.length>50) conversationHistory.shift();
  localStorage.setItem("nerry_history",JSON.stringify(conversationHistory));
}

// Auto-learn and immediately make it usable
function learnAndTalk(input){
  const words=input.toLowerCase().match(/\b\w+\b/g)||[];
  words.forEach(w=>{
    if(!KNOWLEDGE[w] && !dynamicKnowledge[w]){
      dynamicKnowledge[w]={templates:[`I know about ${w}!`],details:[]};
    }
  });
  localStorage.setItem("nerry_dynamic",JSON.stringify(dynamicKnowledge));
}

async function detectIntent(input){
  let bestIntent="default",bestScore=0;
  for(let intent in INTENTS){
    let score=0;
    INTENTS[intent].patterns.forEach(p=>{
      if(input.toLowerCase().includes(p.toLowerCase())) score+=INTENTS[intent].weight;
    });
    if(score>bestScore){ bestScore=score; bestIntent=intent; }
  }
  return bestIntent;
}

async function buildResponse(intent,input){
  let knowledge={...(KNOWLEDGE[intent]||KNOWLEDGE["default"])};
  const words=input.toLowerCase().match(/\b\w+\b/g)||[];
  words.forEach(w=>{
    if(dynamicKnowledge[w]) knowledge={...knowledge,...dynamicKnowledge[w]};
  });
  let template=knowledge.templates[Math.floor(Math.random()*knowledge.templates.length)];
  let response=template.replace("{topic}",input);
  if(knowledge.details.length>0) response+=" "+knowledge.details[Math.floor(Math.random()*knowledge.details.length)];
  return response;
}

async function applyPersonality(text){
  const p=PERSONALITY;
  if(Math.random()<(p.slang_probability||0.2)&&p.slang) text+=" "+p.slang[Math.floor(Math.random()*p.slang.length)];
  if(p.signature_style) text+=" "+p.signature_style[Math.floor(Math.random()*p.signature_style.length)];
  return text;
}

async function nerryProcessInput(input){
  learnAndTalk(input); // immediate learning + usable
  const intent=await detectIntent(input);
  let response=await buildResponse(intent,input);
  response=await applyPersonality(response);
  return response;
}

// ===== UI =====
const chat=document.getElementById("chat");
const input=document.getElementById("userInput");

function addMessage(type,text){
  const p=document.createElement("p");
  p.classList.add("message",type);
  p.innerHTML=text;
  chat.appendChild(p);
  chat.scrollTop=chat.scrollHeight;
}

async function handleSend(){
  const userText=input.value.trim();
  if(!userText) return;
  addMessage("user",`You: ${userText}`);
  input.value="";

  const aiMsg=document.createElement("p");
  aiMsg.classList.add("message","ai");
  aiMsg.innerHTML=`<span class="spinner"></span> Nerry is thinking...`;
  chat.appendChild(aiMsg);
  chat.scrollTop=chat.scrollHeight;

  try{
    const response=await nerryProcessInput(userText);
    aiMsg.innerHTML=`Nerry: ${response}`;
    updateContext(userText,response);
  }catch(e){
    console.error(e);
    aiMsg.innerHTML="Nerry: âš ï¸ Error generating response!";
  }
}

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("sendBtn").addEventListener("click",handleSend);
  input.addEventListener("keyup",e=>{if(e.key==="Enter") handleSend();});
});
</script>
</body>
</html>
